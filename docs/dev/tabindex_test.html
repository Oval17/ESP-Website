<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tab Order Test ‚Äî Before vs After Fix</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; background: #f5f5f5; }
    h2 { color: #333; }
    .info-box {
      background: #d4edda; border: 1px solid #28a745; border-radius: 6px;
      padding: 15px; margin-bottom: 20px; font-size: 14px;
    }
    .panels { display: flex; gap: 30px; }
    .panel { flex: 1; background: white; border: 1px solid #ccc; border-radius: 6px; padding: 20px; }
    .panel-bad { border-color: #dc3545; }
    .panel-good { border-color: #28a745; }
    .panel h3 { margin-top: 0; }
    .panel-bad h3 { color: #dc3545; }
    .panel-good h3 { color: #28a745; }
    .flag-detail { border: 1px solid #aaa; margin-bottom: 10px; border-radius: 4px; }
    .flag-header { padding: 8px; color: white; font-weight: bold; border-radius: 4px 4px 0 0; }
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 8px; vertical-align: top; }
    th { text-align: left; width: 140px; }
    textarea { width: 100%; box-sizing: border-box; }
    .btn { padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; background: #f0f0f0; }
    .btn:focus { outline: 3px solid #007bff; background: #cce5ff; }
    select:focus, textarea:focus, input[type=submit]:focus { outline: 3px solid #007bff; background: #cce5ff; }
    center { margin-top: 8px; }

    .log-section { margin-top: 20px; }
    .log-label { font-weight: bold; font-size: 13px; margin-bottom: 4px; }
    .focus-log {
      background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 6px;
      font-family: monospace; font-size: 12px; min-height: 100px; max-height: 220px;
      overflow-y: auto;
    }
    .focus-log span { display: block; padding: 1px 0; }
    .focus-log .good { color: #4ec9b0; }
    .focus-log .bad  { color: #f48771; }
    .focus-log .neutral { color: #9cdcfe; }
    .focus-log .skip { color: #888; }

    .legend { font-size: 12px; margin-top: 8px; }
    .legend span { margin-right: 12px; }
    .dot-good { color: #4ec9b0; }
    .dot-bad  { color: #f48771; }

    kbd { background:#eee; border:1px solid #ccc; border-radius:3px; padding:1px 5px; font-size:12px; }
    .step-list { font-size: 13px; padding-left: 18px; }
    .step-list li { margin-bottom: 4px; }
    .badge { display:inline-block; border-radius:4px; padding:2px 8px; font-size:12px; font-weight:bold; margin-left:8px; }
    .badge-bad { background:#dc3545; color:white; }
    .badge-good { background:#28a745; color:white; }
  </style>
</head>
<body>

<h2>üß™ Tab Order Demo ‚Äî Before vs After Fix</h2>

<div class="info-box">
  <strong>How to use this page:</strong>
  <ol class="step-list">
    <li>Click <strong>"Add flag"</strong> in each panel to show the new flag form.</li>
    <li>Click the <strong>Flag type dropdown</strong> in either panel to start there.</li>
    <li>Press <kbd>Tab</kbd> repeatedly ‚Äî watch focus jump (blue outline) and the log below each panel.</li>
    <li>Compare the tab sequence in both panels.</li>
  </ol>
</div>

<div class="panels">

  <!-- ===== BEFORE (original broken DOM order) ===== -->
  <div class="panel panel-bad">
    <h3>‚ùå BEFORE Fix <span class="badge badge-bad">Original code (no tabindex)</span></h3>
    <p style="font-size:13px;color:#555;">
      The original template had <code>&lt;th&gt;</code> (label + Save button) <strong>before</strong>
      <code>&lt;td&gt;</code> (textarea) in the DOM. So Tab goes: Flag type ‚Üí <strong>Save</strong> ‚Üí textarea.
      Wrong order!
    </p>

    <div class="flag-detail">
      <div class="flag-header" style="background:#e74c3c;">‚öë Needs Review</div>
      <form action="#" onsubmit="return false;">
        <table><tbody>
          <tr><th>Created:</th><td>Admin on 2026-01-15</td></tr>
          <tr><th>Last modified:</th><td>Admin on 2026-02-01</td></tr>
          <tr>
            <!-- ORIGINAL: th (buttons) BEFORE td (textarea) -->
            <th>
              Comment:<br>
              <input type="submit" class="btn" value="Update" data-log="before" data-label="Update (existing flag)"><br>
              <button type="button" class="btn" data-log="before" data-label="Remove (existing flag)">Remove</button>
            </th>
            <td>
              <textarea rows="3" cols="30" data-log="before" data-label="Textarea (existing flag)">Some comment here.</textarea>
            </td>
          </tr>
        </tbody></table>
      </form>
    </div>

    <div class="flag-detail" id="before-new-flag" style="display:none;">
      <div class="flag-header" style="background:gray;">New Flag</div>
      <form action="#" onsubmit="return false;">
        <table><tbody>
          <tr>
            <th>Flag type:</th>
            <td>
              <!-- ORIGINAL: no tabindex, natural DOM order -->
              <select data-log="before" data-label="Flag type (new flag)">
                <option value="">‚Äî select ‚Äî</option>
                <option>Needs Review</option>
                <option>Approved</option>
              </select>
            </td>
          </tr>
          <tr>
            <!-- ORIGINAL: th (Save) BEFORE td (textarea) in DOM -->
            <th>
              Comment:<br>
              <input type="submit" class="btn" value="Save" data-log="before" data-label="Save (new flag)">
            </th>
            <td>
              <textarea rows="3" cols="30" data-log="before" data-label="Textarea (new flag)"></textarea>
            </td>
          </tr>
        </tbody></table>
      </form>
    </div>

    <center>
      <button class="btn" data-log="before" data-label="Add flag button"
        onclick="document.getElementById('before-new-flag').style.display='block';this.style.display='none';">
        Add flag
      </button>
    </center>

    <div class="log-section">
      <div class="log-label">Focus log (left panel):</div>
      <div class="focus-log" id="log-before"><span class="neutral">‚Äî click Flag type dropdown, then Tab ‚Äî</span></div>
      <div class="legend">
        <span class="dot-good">‚óè correct order</span>
        <span class="dot-bad">‚óè wrong order</span>
      </div>
    </div>
  </div>

  <!-- ===== AFTER (fixed DOM order) ===== -->
  <div class="panel panel-good">
    <h3>‚úÖ AFTER Fix <span class="badge badge-good">Fixed code (no tabindex)</span></h3>
    <p style="font-size:13px;color:#555;">
      The fixed template swaps columns so <code>&lt;td&gt;</code> (textarea) comes <strong>before</strong>
      <code>&lt;th&gt;</code> (Save button) in the DOM. Tab goes: Flag type ‚Üí textarea ‚Üí Save ‚Üí Add flag.
      Correct!
    </p>

    <div class="flag-detail">
      <div class="flag-header" style="background:#e74c3c;">‚öë Needs Review</div>
      <form action="#" onsubmit="return false;">
        <table><tbody>
          <tr><th>Created:</th><td>Admin on 2026-01-15</td></tr>
          <tr><th>Last modified:</th><td>Admin on 2026-02-01</td></tr>
          <tr>
            <!-- FIXED: td (textarea) BEFORE th (buttons) -->
            <td>
              <textarea rows="3" cols="30" data-log="after" data-label="Textarea (existing flag)">Some comment here.</textarea>
            </td>
            <th>
              Comment:<br>
              <input type="submit" class="btn" value="Update" data-log="after" data-label="Update (existing flag)"><br>
              <button type="button" class="btn" data-log="after" data-label="Remove (existing flag)">Remove</button>
            </th>
          </tr>
        </tbody></table>
      </form>
    </div>

    <div class="flag-detail" id="after-new-flag" style="display:none;">
      <div class="flag-header" style="background:gray;">New Flag</div>
      <form action="#" onsubmit="return false;">
        <table><tbody>
          <tr>
            <th>Flag type:</th>
            <td>
              <select data-log="after" data-label="Flag type (new flag)">
                <option value="">‚Äî select ‚Äî</option>
                <option>Needs Review</option>
                <option>Approved</option>
              </select>
            </td>
          </tr>
          <tr>
            <!-- FIXED: td (textarea) BEFORE th (Save) -->
            <td>
              <textarea rows="3" cols="30" data-log="after" data-label="Textarea (new flag)"></textarea>
            </td>
            <th>
              Comment:<br>
              <input type="submit" class="btn" value="Save" data-log="after" data-label="Save (new flag)">
            </th>
          </tr>
        </tbody></table>
      </form>
    </div>

    <center>
      <button class="btn" data-log="after" data-label="Add flag button"
        onclick="document.getElementById('after-new-flag').style.display='block';this.style.display='none';">
        Add flag
      </button>
    </center>

    <div class="log-section">
      <div class="log-label">Focus log (right panel):</div>
      <div class="focus-log" id="log-after"><span class="neutral">‚Äî click Flag type dropdown, then Tab ‚Äî</span></div>
      <div class="legend">
        <span class="dot-good">‚óè correct order</span>
        <span class="dot-bad">‚óè wrong order</span>
      </div>
    </div>
  </div>

</div>

<script>
  // Expected correct tab order for the new flag form
  var expectedOrder = [
    'Flag type (new flag)',
    'Textarea (new flag)',
    'Save (new flag)',
    'Add flag button'
  ];

  var counts = { before: 0, after: 0 };
  var orderIdx = { before: 0, after: 0 };

  document.addEventListener('focusin', function(e) {
    var el = e.target;
    var panel = el.getAttribute('data-log');
    if (!panel) return; // ignore elements without data-log (page chrome)

    var label = el.getAttribute('data-label') || el.tagName;
    var logEl = document.getElementById('log-' + panel);

    counts[panel]++;
    var n = counts[panel];

    var expectedNext = expectedOrder[orderIdx[panel]];
    var cls = 'neutral';
    var note = '';

    if (expectedOrder.indexOf(label) !== -1) {
      if (label === expectedNext) {
        cls = 'good';
        note = ' ‚úì';
        orderIdx[panel] = (orderIdx[panel] + 1) % expectedOrder.length;
      } else {
        cls = 'bad';
        note = ' ‚úó (expected: ' + expectedNext + ')';
      }
    }

    // Clear placeholder
    if (logEl.querySelector('.neutral')) {
      logEl.innerHTML = '';
    }

    var entry = document.createElement('span');
    entry.className = cls;
    entry.textContent = '#' + n + ': ' + label + note;
    logEl.appendChild(entry);
    logEl.scrollTop = logEl.scrollHeight;
  });
</script>

</body>
</html>
